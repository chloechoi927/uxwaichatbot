<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src data:; style-src 'unsafe-inline'; script-src 'unsafe-inline'; font-src 'self' data:; connect-src https:;">
<title>UX Writing Assistant Pro</title>
<style>
  * { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-size: 13px;
    line-height: 1.4;
    color: #1d1d1f;
    background: #f8f9fa;
    overflow: hidden;
  }

  .container {
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: white;
    max-height: 100vh;
    overflow: hidden;
  }

  /* Header - Frontitude ìŠ¤íƒ€ì¼ */
  .header {
    background: white;
    color: #333;
    padding: 16px;
    flex-shrink: 0;
    border-bottom: 1px solid #e5e7eb;
  }

  .header-title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: #333;
  }

  .header-subtitle {
    font-size: 11px;
    color: #666;
    margin-bottom: 12px;
  }

  /* ê¸°ëŠ¥ íƒ­ - Frontitude ìŠ¤íƒ€ì¼ */
  .function-tabs {
    display: flex;
    background: #f8f9fa;
    border-radius: 6px;
    padding: 2px;
    margin-bottom: 8px;
    border: 1px solid #e5e7eb;
  }

  .function-tab {
    flex: 1;
    padding: 6px 8px;
    background: transparent;
    border: none;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 2px solid transparent;
  }

  .function-tab.active {
    background: #8b5cf6;
    color: white;
    border-bottom-color: #8b5cf6;
  }

  /* ì¹´í…Œê³ ë¦¬ íƒ­ - Frontitude ìŠ¤íƒ€ì¼ */
  .nav-tabs {
    display: flex;
    background: #f8f9fa;
    border-radius: 6px;
    padding: 2px;
    margin-bottom: 12px;
    border: 1px solid #e5e7eb;
  }

  .nav-tab {
    flex: 1;
    padding: 6px 8px;
    background: transparent;
    border: none;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .nav-tab.active {
    background: #8b5cf6;
    color: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  /* ìŠ¤ìº” ë²„íŠ¼ - Frontitude ìŠ¤íƒ€ì¼ */
  .scan-button {
    width: 100%;
    padding: 12px;
    background: #8b5cf6;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .scan-button:hover:not(:disabled) {
    background: #7c3aed;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  .scan-button:disabled {
    background: rgba(255, 255, 255, 0.5);
    cursor: not-allowed;
    transform: none;
  }

  /* Main content */
  .main {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }

  .status {
    padding: 8px 16px;
    margin: 0;
    font-size: 11px;
    display: none;
    border-bottom: 1px solid transparent;
    flex-shrink: 0;
    word-wrap: break-word;
    white-space: normal;
    line-height: 1.4;
  }

  .status.info {
    background: #e0f2fe;
    color: #0277bd;
    border-bottom: 1px solid #b3e5fc;
  }

  .status.error {
    background: #ffebee;
    color: #c62828;
    border-bottom: 1px solid #ffcdd2;
  }

  .status.success {
    background: #e8f5e8;
    color: #2e7d32;
    border-bottom: 1px solid #c8e6c9;
  }

  /* í…ìŠ¤íŠ¸ ì…ë ¥ ì„¹ì…˜ - Frontitude ìŠ¤íƒ€ì¼ */
  .text-input-section {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .input-label {
    font-size: 12px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    display: block;
  }

  .text-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 13px;
    line-height: 1.4;
    resize: vertical;
    min-height: 60px;
    font-family: inherit;
  }

  .text-input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  /* ê°œì„ ëœ í…ìŠ¤íŠ¸ ì„¹ì…˜ */
  .improved-text-section {
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .improved-text {
    background: white;
    border: 1px solid #bae6fd;
    border-radius: 6px;
    padding: 12px;
    font-size: 13px;
    color: #1d1d1f;
    line-height: 1.4;
    margin-top: 8px;
  }

  /* ì ìš©ëœ UX ì›ì¹™ */
  .ux-principles {
    background: #fef3c7;
    border: 1px solid #fde68a;
    border-radius: 6px;
    padding: 12px;
    margin-top: 12px;
  }

  .principles-title {
    font-size: 11px;
    font-weight: 600;
    color: #92400e;
    margin-bottom: 6px;
  }

  .principle-item {
    font-size: 10px;
    color: #92400e;
    margin-bottom: 4px;
    padding-left: 8px;
    position: relative;
  }

  .principle-item::before {
    content: "â€¢";
    position: absolute;
    left: 0;
  }

  /* ì œì•ˆ ì„¹ì…˜ - Frontitude ìŠ¤íƒ€ì¼ */
  .suggestions-section {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .suggestions-title {
    font-size: 12px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .suggestion-item {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  .suggestion-item:hover {
    background: #f3f4f6;
    border-color: #6366f1;
  }

  .suggestion-item.selected {
    background: #eef2ff;
    border-color: #6366f1;
  }

  .suggestion-text {
    font-size: 13px;
    color: #1d1d1f;
    line-height: 1.4;
    margin-bottom: 6px;
  }

  .suggestion-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 10px;
    color: #6b7280;
  }

  .suggestion-score {
    background: #10b981;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 500;
  }

  .suggestion-tags {
    display: flex;
    gap: 4px;
  }

  .tag {
    background: #e5e7eb;
    color: #6b7280;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 9px;
  }

  /* ë‹¤êµ­ì–´ ë²ˆì—­ ì„¹ì…˜ */
  .translations-section {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .translations-title {
    font-size: 12px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .translation-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .translation-item {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 10px;
    transition: all 0.2s ease;
  }

  .translation-item:hover {
    background: #f3f4f6;
    border-color: #6366f1;
  }

  .suggestion-content, .translation-content {
    margin-bottom: 8px;
  }

  .suggestion-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }

  .translation-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }

  .copy-btn {
    background: transparent;
    color: #6b7280;
    border: none;
    border-radius: 4px;
    padding: 4px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .copy-btn:hover {
    background: #f3f4f6;
    color: #374151;
  }

  .copy-btn svg {
    width: 14px;
    height: 14px;
  }

  .improved-sentence-section {
    margin-bottom: 16px;
  }

  .improved-sentence-card {
    background: #f0f9ff;
    border: 1px solid #bae6fd;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }

  .improved-text {
    font-size: 14px;
    font-weight: 500;
    color: #0369a1;
    flex: 1;
  }

  .translation-lang {
    font-size: 10px;
    font-weight: 600;
    color: #6b7280;
    margin-bottom: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .translation-quality {
    font-size: 8px;
    padding: 2px 4px;
    border-radius: 3px;
    background: #10b981;
    color: white;
  }

  .translation-text {
    font-size: 12px;
    color: #1d1d1f;
    margin-bottom: 6px;
    word-break: break-word;
  }

  .translation-length {
    font-size: 10px;
    color: #6b7280;
  }

  /* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
  .actions {
    display: flex;
    gap: 8px;
    margin-top: 16px;
  }

  .btn {
    flex: 1;
    padding: 10px 16px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: white;
    color: #374151;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
  }

  .btn:hover:not(:disabled) {
    background: #f9fafb;
    border-color: #9ca3af;
  }

  .btn.primary {
    background: #6366f1;
    color: white;
    border-color: #6366f1;
  }

  .btn.primary:hover:not(:disabled) {
    background: #5b21b6;
  }

  .btn.success {
    background: #10b981;
    color: white;
    border-color: #10b981;
  }

  .btn.success:hover:not(:disabled) {
    background: #059669;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #6b7280;
  }

  .empty-icon {
    font-size: 32px;
    margin-bottom: 12px;
    opacity: 0.6;
  }

  .empty-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
    color: #374151;
  }

  .empty-subtitle {
    font-size: 12px;
    line-height: 1.4;
  }

  /* Loading */
  .spinner {
    width: 14px;
    height: 14px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Scrollbar */
  .content::-webkit-scrollbar {
    width: 4px;
  }

  .content::-webkit-scrollbar-track {
    background: transparent;
  }

  .content::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 2px;
  }

  .content::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
  }

  /* Responsive */
  @media (max-width: 400px) {
    .translation-grid {
      grid-template-columns: 1fr;
    }
    
    .actions {
      flex-direction: column;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-title">
        <span>âœ¨</span>
        UX Writing Assistant Pro
      </div>
      <div class="header-subtitle">
        AI ê¸°ë°˜ í…ìŠ¤íŠ¸ ë¶„ì„, ë²ˆì—­ ë° UX ìµœì í™”
      </div>
      
      <!-- ê¸°ëŠ¥ íƒ­ -->
      <div class="function-tabs" id="functionTabs">
        <button class="function-tab active" data-function="review">ë¬¸ì¥ ê²€ìˆ˜</button>
        <button class="function-tab" data-function="generate">ë¬¸ì¥ ìƒì„±</button>
        <button class="function-tab" data-function="multilingual">ë‹¤êµ­ì–´</button>
        <button class="function-tab" data-function="code">ë‹¤êµ­ì–´ ì½”ë“œ ì±„ë²ˆ</button>
      </div>
      
      <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
      <div class="nav-tabs" id="navTabs">
        <button class="nav-tab active" data-type="S">ì„œë¹„ìŠ¤(S)</button>
        <button class="nav-tab" data-type="A">ì–´ë“œë¯¼(A)</button>
        <button class="nav-tab" data-type="P">ì•±(P)</button>
        <button class="nav-tab" data-type="B">ë²„íŠ¼(B)</button>
        <button class="nav-tab" data-type="C">ê³µí†µ(C)</button>
      </div>
      
      <button class="scan-button" id="scanButton">
        <span id="scanText">ğŸ” ì„ íƒëœ í…ìŠ¤íŠ¸ ìŠ¤ìº”í•˜ê¸°</span>
        <div class="spinner" id="spinner" style="display: none;"></div>
      </button>
    </div>

    <div class="main">
      <div class="status" id="status"></div>
      <div class="content" id="content">
        <div id="results"></div>
        
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">ğŸ¯</div>
          <div class="empty-title">í…ìŠ¤íŠ¸ ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
          <div class="empty-subtitle">
            AI ê¸°ë°˜ UX ë¼ì´íŒ… ì œì•ˆ,<br>
            ë‹¤êµ­ì–´ ë²ˆì—­, ê·¸ë¦¬ê³ <br>
            ìë™ ì½”ë“œ ìƒì„±ì„ ë°›ì•„ë³´ì„¸ìš”.
          </div>
        </div>

        <div class="tip" style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; padding: 12px; margin: 16px 0; font-size: 11px; color: #0369a1;">
          <span style="margin-right: 4px;">ğŸ’¡</span>
          <strong>ì‚¬ìš©ë²•:</strong> Figmaì—ì„œ í…ìŠ¤íŠ¸ ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ê³  ìŠ¤ìº” ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”. 
          í¬ê´„ì ì¸ UX ë¶„ì„, ë²ˆì—­, AI ì œì•ˆì„ ë°›ì•„ë³´ì„¸ìš”.
        </div>
      </div>
    </div>
  </div>

<script>
(function() {
  let currentCodeType = 'S';
  let isLoading = false;
  let selectedSuggestions = [];

  // DOM elements
  const functionTabs = document.getElementById('functionTabs');
  const navTabs = document.getElementById('navTabs');
  const scanButton = document.getElementById('scanButton');
  const scanText = document.getElementById('scanText');
  const spinner = document.getElementById('spinner');
  const status = document.getElementById('status');
  const results = document.getElementById('results');
  const emptyState = document.getElementById('emptyState');

  let currentFunction = 'review';

  // ê¸°ëŠ¥ íƒ­ ì´ë²¤íŠ¸
  functionTabs.addEventListener('click', (e) => {
    if (e.target.classList.contains('function-tab')) {
      functionTabs.querySelectorAll('.function-tab').forEach(tab => tab.classList.remove('active'));
      e.target.classList.add('active');
      currentFunction = e.target.dataset.function;
      updateUIForFunction(currentFunction);
    }
  });

  // ì¹´í…Œê³ ë¦¬ íƒ­ ì´ë²¤íŠ¸
  navTabs.addEventListener('click', (e) => {
    if (e.target.classList.contains('nav-tab')) {
      navTabs.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
      e.target.classList.add('active');
      currentCodeType = e.target.dataset.type;
    }
  });

  // ê¸°ëŠ¥ì— ë”°ë¥¸ UI ì—…ë°ì´íŠ¸
  function updateUIForFunction(functionType) {
    const scanButton = document.getElementById('scanButton');
    const scanText = document.getElementById('scanText');
    
    switch(functionType) {
      case 'review':
        scanText.textContent = 'ğŸ” ì„ íƒëœ í…ìŠ¤íŠ¸ ìŠ¤ìº”í•˜ê¸°';
        break;
      case 'generate':
        scanText.textContent = 'âœ¨ ë¬¸ì¥ ìƒì„±í•˜ê¸°';
        break;
      case 'multilingual':
        scanText.textContent = 'ğŸŒ ë‹¤êµ­ì–´ ë²ˆì—­í•˜ê¸°';
        break;
      case 'code':
        scanText.textContent = 'ğŸ“‹ ì½”ë“œ ì±„ë²ˆí•˜ê¸°';
        break;
    }
  }

  // í´ë¦½ë³´ë“œ ë³µì‚¬ ê¸°ëŠ¥ (ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡)
  window.copyToClipboard = function(text) {
    // í…ìŠ¤íŠ¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬
    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(text).then(() => {
        showCopyFeedback(event.target);
      }).catch(err => {
        console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
        fallbackCopyTextToClipboard(text);
      });
    } else {
      // í´ë°± ë°©ë²•
      fallbackCopyTextToClipboard(text);
    }
  }

  // í´ë°± ë³µì‚¬ ë°©ë²•
  function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
      const successful = document.execCommand('copy');
      if (successful) {
        showCopyFeedback(event.target);
      } else {
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    } catch (err) {
      console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
      alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
    
    document.body.removeChild(textArea);
  }

  // ë³µì‚¬ í”¼ë“œë°± í‘œì‹œ
  function showCopyFeedback(btn) {
    const originalContent = btn.innerHTML;
    btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"></path></svg>';
    btn.style.color = '#10b981';
    setTimeout(() => {
      btn.innerHTML = originalContent;
      btn.style.color = '#6b7280';
    }, 1000);
  };

  // í…ìŠ¤íŠ¸ ìˆ˜ì • ì ìš© ê¸°ëŠ¥
  function applyTextModification() {
    // í˜„ì¬ ê²°ê³¼ì—ì„œ ê°œì„ ëœ ë¬¸ì¥ ì°¾ê¸°
    const resultsContainer = document.getElementById('results');
    const improvedTextElement = resultsContainer.querySelector('.improved-text');
    
    if (!improvedTextElement) {
      alert('ê°œì„ ëœ ë¬¸ì¥ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    const selectedText = improvedTextElement.textContent;
    
    // í”¼ê·¸ë§ˆì— í…ìŠ¤íŠ¸ ìˆ˜ì • ìš”ì²­
    parent.postMessage({
      pluginMessage: {
        type: 'apply-text-modification',
        text: selectedText
      }
    }, '*');
  }

  // ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ
  window.addEventListener('message', (event) => {
    const { type, data, message, error } = event.data;
    
    if (type === 'ready') {
      hideStatus();
    } else if (type === 'loading') {
      showStatus(message, 'loading');
    } else if (type === 'scan-results') {
      hideStatus();
      renderResults(data);
    } else if (type === 'error') {
      hideStatus();
      showStatus(message, 'error');
    } else if (type === 'success') {
      hideStatus();
      showStatus(message, 'success');
    } else if (type === 'code-generated') {
      showStatus('ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ' + data.code, 'success');
    } else if (type === 'code-error') {
      showStatus('ì½”ë“œ ìƒì„± ì‹¤íŒ¨: ' + error, 'error');
    }
  });

  // Scan button event
  scanButton.addEventListener('click', () => {
    if (isLoading) return;
    
    setLoading(true);
    hideStatus();
    postMessage({ type: 'scan-selection', codeType: currentCodeType });
  });

  // Loading state management
  function setLoading(loading) {
    isLoading = loading;
    scanButton.disabled = loading;
    
    if (loading) {
      scanText.style.display = 'none';
      spinner.style.display = 'block';
    } else {
      scanText.style.display = 'block';
      spinner.style.display = 'none';
    }
  }

  // Status message display
  function showStatus(message, type = 'info') {
    status.textContent = message;
    status.className = `status ${type}`;
    status.style.display = 'block';
  }

  function hideStatus() {
    status.style.display = 'none';
  }

  // ì œì•ˆ ì•„ì´í…œ ë Œë”ë§
  function renderSuggestionItem(suggestion, index) {
    const isSelected = selectedSuggestions.includes(index);
    return `
      <div class="suggestion-item ${isSelected ? 'selected' : ''}" data-index="${index}">
        <div class="suggestion-content">
          <div class="suggestion-text">${suggestion.text}</div>
        </div>
        <div class="suggestion-footer">
          <div class="suggestion-meta">
            <div class="suggestion-score">${suggestion.score}%</div>
            <div class="suggestion-tags">
              ${suggestion.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
            </div>
          </div>
          <button class="copy-btn" onclick="copyToClipboard('${suggestion.text.replace(/'/g, "\\'")}')" title="ë³µì‚¬">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
        </div>
      </div>
    `;
  }

  // ë²ˆì—­ ì•„ì´í…œ ë Œë”ë§
  function renderTranslationItem(lang, data) {
    const langNames = {
      en: 'ENGLISH',
      ja: 'æ—¥æœ¬èª',
      'zh-cn': 'ä¸­æ–‡ç®€',
      'zh-tw': 'ä¸­æ–‡ç¹',
      es: 'ESPAÃ‘OL',
      fr: 'FRANÃ‡AIS',
      de: 'DEUTSCH',
      it: 'ITALIANO',
      pt: 'PORTUGUÃŠS',
      ru: 'Ğ Ğ£Ğ¡Ğ¡ĞšĞ˜Ğ™',
      ar: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
      hi: 'à¤¹à¤¿à¤¨à¥à¤¦à¥€',
      th: 'à¹„à¸—à¸¢',
      vi: 'TIáº¾NG VIá»†T'
    };

    const qualityLabel = data.quality === 'ai-generated' ? 'AI' : 'DEV';
    const qualityClass = data.quality === 'ai-generated' ? '' : 'placeholder';
    const lengthStatus = data.length.status === 'ok' ? 'âœ“' : '?';

    return `
      <div class="translation-item">
        <div class="translation-lang">
          [${lang.toUpperCase()}] ${langNames[lang] || lang}
          <span class="translation-quality ${qualityClass}">${qualityLabel}</span>
        </div>
        <div class="translation-content">
          <div class="translation-text">${data.text}</div>
        </div>
        <div class="translation-footer">
          <div class="translation-length">${data.length.current || 0}/${data.length.max || 0} ${lengthStatus}</div>
          <button class="copy-btn" onclick="copyToClipboard('${data.text.replace(/'/g, "\\'")}')" title="ë³µì‚¬">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
        </div>
      </div>
    `;
  }

  // ê²°ê³¼ ì¹´ë“œ ë Œë”ë§ - Frontitude ìŠ¤íƒ€ì¼
  function renderResultCard(item) {
    const isExisting = item.type === 'existing';
    const analysis = item.analysis || {};
    const violations = analysis.localAnalysis?.violations || [];
    const translations = item.translations || {};
    const suggestions = item.suggestions || [];
    const screenType = item.screenType || 'user';

    return `
      <div class="result-card" style="background: white; border: none; border-radius: 8px; margin-bottom: 16px; overflow: hidden;">
        <!-- ê¸°ì¡´ ë¬¸ì¥ ì„¹ì…˜ -->
        <div class="text-input-section">
          <label class="input-label">ê¸°ì¡´ ë¬¸ì¥</label>
          <div class="text-input" style="background: #f9fafb; border: none; border-radius: 6px; padding: 12px; font-size: 13px; line-height: 1.4; min-height: 40px;">
            ${item.text}
          </div>
        </div>

        <!-- ê°œì„ ëœ ë¬¸ì¥ ì„¹ì…˜ (í†µí•©) -->
        ${suggestions.length > 0 ? `
          <div class="improved-sentence-section">
            <div class="suggestions-title">
              <span>âœ¨</span>
              ê°œì„ ëœ ë¬¸ì¥
            </div>
            <div class="improved-sentence-card">
              <div class="improved-text">${suggestions.find(s => s.type === 'improvement')?.text || suggestions[0].text}</div>
              <button class="copy-btn" onclick="copyToClipboard('${(suggestions.find(s => s.type === 'improvement')?.text || suggestions[0].text).replace(/'/g, "\\'")}')" title="ë³µì‚¬">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
              </button>
            </div>
            
            <div class="ux-principles">
              <div class="principles-title">ì ìš©ëœ UX ì›ì¹™</div>
              <div class="principle-item">ì‚¬ìš©ì ì¹œí™”ì ì¸ ë¬¸êµ¬ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ì •í•¨.</div>
              <div class="principle-item">í•˜ì‹­ì‹œì˜¤ â†’ í•´ì£¼ì„¸ìš”ë¡œ ì“°ê¸°ë¡œ ì •í•¨.</div>
            </div>
          </div>
        ` : ''}

        <!-- ì œì•ˆ ë¬¸êµ¬ ì„¹ì…˜ -->
        ${suggestions.length > 0 ? `
          <div class="suggestions-section">
            <div class="suggestions-title">
              <span>ğŸ’¡</span>
              AI ì œì•ˆ ë¬¸êµ¬
            </div>
            ${suggestions.map((suggestion, index) => renderSuggestionItem(suggestion, index)).join('')}
          </div>
        ` : ''}

        <!-- ë‹¤êµ­ì–´ ë²ˆì—­ ì„¹ì…˜ -->
        ${Object.keys(translations).length > 0 ? `
          <div class="translations-section">
            <div class="suggestions-title">
              <span>ğŸŒ</span>
              AI ë‹¤êµ­ì–´ ë²ˆì—­
            </div>
            <div class="translation-grid">
              ${Object.entries(translations).map(([lang, data]) => renderTranslationItem(lang, data)).join('')}
            </div>
          </div>
        ` : ''}

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="actions">
          ${suggestions.length > 0 ? `
            <button class="btn success apply-corrections" data-node-id="${item.nodeId}" data-text="${encodeURIComponent(suggestions.find(s => s.type === 'improvement')?.text || suggestions[0].text)}">
              í…ìŠ¤íŠ¸ ìˆ˜ì • ì ìš©
            </button>
          ` : ''}
        </div>
      </div>
    `;
  }

  // ê²°ê³¼ ë Œë”ë§
  function renderResults(data) {
    emptyState.style.display = 'none';
    
    if (!data || !data.length) {
      results.innerHTML = '';
      emptyState.style.display = 'block';
      return;
    }

    results.innerHTML = data.map(renderResultCard).join('');
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    results.querySelectorAll('.apply-code').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const nodeId = e.target.dataset.nodeId;
        const code = e.target.dataset.code;
        postMessage({ type: 'apply-code', data: { nodeId, code } });
        e.target.textContent = 'ì ìš©ë¨ âœ“';
        e.target.disabled = true;
      });
    });

    results.querySelectorAll('.apply-corrections').forEach(btn => {
      btn.addEventListener('click', (e) => {
        // ê°œì„ ëœ ë¬¸ì¥ì„ ì°¾ì•„ì„œ ì ìš©
        const resultsContainer = document.getElementById('results');
        const improvedTextElement = resultsContainer.querySelector('.improved-text');
        
        if (improvedTextElement) {
          const selectedText = improvedTextElement.textContent;
          console.log('í…ìŠ¤íŠ¸ ìˆ˜ì • ì ìš© ì‹œë„:', selectedText);
          
          // í”¼ê·¸ë§ˆì— í…ìŠ¤íŠ¸ ìˆ˜ì • ìš”ì²­
          parent.postMessage({
            pluginMessage: {
              type: 'apply-text-modification',
              text: selectedText
            }
          }, '*');
          
          e.target.textContent = 'ìˆ˜ì •ë¨ âœ“';
          e.target.disabled = true;
        } else {
          console.error('ê°œì„ ëœ ë¬¸ì¥ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          alert('ê°œì„ ëœ ë¬¸ì¥ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      });
    });

    // ì œì•ˆ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
    results.querySelectorAll('.suggestion-item').forEach(item => {
      item.addEventListener('click', (e) => {
        const index = parseInt(e.currentTarget.dataset.index);
        const isSelected = selectedSuggestions.includes(index);
        
        if (isSelected) {
          selectedSuggestions = selectedSuggestions.filter(i => i !== index);
          e.currentTarget.classList.remove('selected');
        } else {
          selectedSuggestions.push(index);
          e.currentTarget.classList.add('selected');
        }
      });
    });
  }

  // Message sending
  function postMessage(message) {
    parent.postMessage({ pluginMessage: message }, '*');
  }

  // Message receiving handling
  window.onmessage = (event) => {
    const msg = event.data.pluginMessage;
    if (!msg) return;

    switch (msg.type) {
      case 'ready':
        showStatus('í”ŒëŸ¬ê·¸ì¸ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        setTimeout(hideStatus, 2000);
        break;

      case 'loading':
        setLoading(true);
        showStatus(msg.message || 'ì²˜ë¦¬ ì¤‘...', 'info');
        break;

      case 'error':
        setLoading(false);
        showStatus(msg.message, 'error');
        break;

      case 'scan-results':
        setLoading(false);
        hideStatus();
        renderResults(msg.data);
        
        if (msg.data && msg.data.length > 0) {
          const newCount = msg.data.filter(item => item.type === 'new').length;
          const existingCount = msg.data.filter(item => item.type === 'existing').length;
          
          let message = `${msg.data.length}ê°œ í…ìŠ¤íŠ¸ ë¶„ì„ ì™„ë£Œ`;
          if (newCount > 0 && existingCount > 0) {
            message += ` (ì‹ ê·œ ${newCount}ê°œ, ê¸°ì¡´ ${existingCount}ê°œ)`;
          } else if (newCount > 0) {
            message += ` (ì‹ ê·œ ì½”ë“œ ${newCount}ê°œ ìƒì„±)`;
          } else if (existingCount > 0) {
            message += ` (ê¸°ì¡´ ì½”ë“œ ${existingCount}ê°œ ë°œê²¬)`;
          }
          
          showStatus(message, 'success');
          setTimeout(hideStatus, 3000);
        }
        break;
    }
  };

  // Initialization
  postMessage({ type: 'init' });
})();
</script>
</body>
</html>